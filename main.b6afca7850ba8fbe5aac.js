(()=>{"use strict";const e="https://react-learnwords-2022.herokuapp.com/",t=e=>({Authorization:`Bearer ${e}`,Accept:"application/json","Content-Type":"application/json"});async function n(n){const o=document.querySelector(".account__text"),a=document.querySelector(".account");a.classList.contains("account")&&(a.classList.remove("account"),a.classList.add("account__out")),await async function(n,o,a){const s=await async function(n,o){return await fetch(`${e}users/${n}`,{method:"GET",headers:t(o)}).then((e=>e.json())).catch((e=>console.log(e.message)))}(n,o);if(!s){const o=await async function(n,o){return await fetch(`${e}users/${n}/tokens`,{method:"GET",headers:t(o)}).then((e=>e.json())).catch((e=>console.log(e.message)))}(n,a);o&&(localStorage.setItem("token",JSON.stringify(o.token)),localStorage.setItem("refreshToken",JSON.stringify(o.refreshToken)))}}(n.id,n.token,n.refreshToken),o.innerHTML=`${n.name}/Log Out`}async function o(t){const o=await async function(t){let n={email:"",password:""};t&&(n=t);const o=await fetch(`${e}signin`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return o.ok?await o.json():o.status}(t);if("number"==typeof o){const e=document.querySelector(".menu__text");404===o&&(e.innerHTML="Такой почты не существует!"),403===o&&(e.innerHTML="Неправильный адрес электронной почты или пароль!"),e.style.color="red",e.style.fontSize="x-large"}else a=o.userId,s=o.token,i=o.name,r=o.refreshToken,localStorage.setItem("id",JSON.stringify(a)),localStorage.setItem("token",JSON.stringify(s)),localStorage.setItem("name",JSON.stringify(i)),localStorage.setItem("refreshToken",JSON.stringify(r)),n({id:o.userId,token:o.token,name:o.name,refreshToken:o.refreshToken});var a,s,i,r}class a{get token(){return JSON.parse(localStorage.getItem("token"))}get id(){return JSON.parse(localStorage.getItem("id"))}get name(){return JSON.parse(localStorage.getItem("name"))}get refreshToken(){return JSON.parse(localStorage.getItem("refreshToken"))}}async function s(n,o,a){return await fetch(`${e}users/${n}/words/${o}`,{method:"GET",headers:t(a)}).then((e=>e.json())).catch((e=>console.log(e.message)))}async function i({id:n,idWord:o,token:a,body:s}){return await fetch(`${e}users/${n}/words/${o}`,{method:"POST",headers:t(a),body:JSON.stringify(s)}).then((e=>e.json())).catch((e=>console.log(e.message)))}async function r({id:n,idWord:o,token:a,body:s}){return await fetch(`${e}users/${n}/words/${o}`,{method:"PUT",headers:t(a),body:JSON.stringify(s)}).then((e=>e.json())).catch((e=>console.log(e.message)))}async function c(n,o,a){return await fetch(`${e}users/${n}/words/${o}`,{method:"DELETE",headers:t(a)}).then((e=>e.json())).catch((e=>console.log(e.message)))}function l(){const e=document.querySelectorAll(".list-textbook__elem");let t=0;for(let n=0;n<e.length;n++)(e[n].classList.contains("hard")||e[n].classList.contains("studied"))&&t++;const n=document.querySelector(".main"),o=document.querySelector(".number-page");t==e.length?(n.classList.add("studied-page"),o.classList.add("pagination-studied")):o.classList.contains("pagination-studied")&&n.classList.contains("studied-page")&&(n.classList.remove("studied-page"),o.classList.remove("pagination-studied"))}function d(e){const t=new URLSearchParams(document.location.search);let n=t.get("page"),o=t.get("group");n||o||(n="1",o="1");const a=Number(n);let s;const i=`${document.location.origin}${document.location.pathname}`;"back-all"===e&&(s=1),"back"===e&&(s=a<=1?1:a-1),"forward"===e&&(s=a>=30?30:a+1),"forward-all"===e&&(s=30),window.location.href=`${i}?group=${o}&page=${s||1}`}const u=new class{templateLogin(){return'\n    <div class="close"></div>\n    <h3 class="menu-heading">Войти</h3>\n    <div class="menu__text">\n      Войдите в свою учетную запись, используя адрес электронной почты и\n      пароль, указанные при регистрации.\n    </div>\n    <form class="form">\n      <label>\n        <h5>Email</h5>\n        <input type="email" name="email" required placeholder="Введите логин"/>\n      </label>\n      <label>\n        <h5>Password</h5>\n        <input type="text" name="password" minlength="8" maxlength="20" required placeholder="Введите пароль"/>\n      </label>\n      <button type="submit" class="sign__button btn btn-orange">Войти</button>\n      <div class="signIn">\n      У Вас нет аккаунта? <span>Зарегистрировать</span>\n      </div>\n    </form>\n    '}templateRegistration(){return'\n    <div class="close"></div>\n    <h3 class="menu-heading">Регистрация</h3>\n    <div class="menu__text">\n      Регистрация занимает меньше минуты, но дает вам полный контроль над учебой.\n    </div>\n    <form class="form" action="">\n      <label>\n        <h5>Login</h5>\n        <input type="text" name="login" required placeholder="Введите логин"/>\n      </label>\n      <label>\n        <h5>Password</h5>\n        <input type="text" name="pass" minlength="8" maxlength="20" required placeholder="Введите пароль"/>\n      </label>\n      <label>\n        <h5>Email</h5>\n        <input type="email" name="email" required placeholder="Введите емейл"/>\n      </label>\n      <button type="submit" class="registration__button btn btn-orange">Регистрация</button>\n      <div class="registration">\n      У вас уже есть аккаунт? <span>Войти</span>\n      </div>\n    </а>\n    </form>\n    '}};function m(){document.body.addEventListener("click",(async function(t){const n=document.querySelector(".login-popUp"),m=document.querySelector(".login-popUp .menu"),h=t.target,p=/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/iu;if(!h.closest(".close")&&h.closest(".menu")||(n.style.transform="translateX(100%)"),h.closest(".account")&&(m.innerHTML=u.templateLogin(),n.style.transform="translateX(0%)"),h.closest(".signIn")?m.innerHTML=u.templateRegistration():h.closest(".registration")&&(m.innerHTML=u.templateLogin()),h.closest(".sign__button")){const e=document.querySelector('input[name="email"]').value,n=document.querySelector('input[name="password"]').value;if(p.test(e)&&n.length>=8){t.preventDefault();const a={email:e,password:n};await o(a),location.reload()}}if(h.closest(".registration__button")){const n=document.querySelector('input[name="email"]').value,a=document.querySelector('input[name="login"]').value,s=document.querySelector('input[name="pass"]').value;p.test(n)&&s.length>8&&a&&(t.preventDefault(),async function(t){try{await async function(t){const n=await fetch(`${e}users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(n){const e=await n.json();return n.ok?e:e.error.errors[0].message}}(t),await o({email:t.email,password:t.password}),location.reload()}catch{const e=document.querySelector(".menu__text");e.innerHTML="Такая почта уже занята",e.style.color="red",e.style.fontSize="x-large"}}({name:a,email:n,password:s}))}if(h.closest(".account__out")&&(localStorage.removeItem("id"),localStorage.removeItem("token"),localStorage.removeItem("name"),location.reload()),h.closest(".audio")&&async function(t){const n=await async function(t){const n=await fetch(`${e}words/${t}`);return await n.json()}(t),o=["audio","audioExample","audioMeaning"],a=document.querySelector(`svg[data-id="${t}"]`).firstChild;a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","assets/ico/audio-play.svg#Capa_1");const s=new Audio;s.src=`${e}${n[o[0]]}`,s.autoplay=!0;let i=0;s.onended=function(){i++,i<o.length?(s.src=`${e}${n[o[i]]}`,s.play()):a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","assets/ico/audio-mute.svg#Capa_1")}}(h.dataset.id),h.closest(".back-all")&&d("back-all"),h.closest(".back")&&d("back"),h.closest(".forward")&&d("forward"),h.closest(".forward-all")&&d("forward-all"),h.closest(".cont-button__add")){const e=h.parentNode.parentNode,t=e.dataset.id;if(!e.classList.contains("hard")){e.classList.add("hard");const n=new a;!async function(e,t,n){const o={difficulty:"hard",optional:{}};await s(e,t,n)?await r({id:e,idWord:t,token:n,body:o}):await i({id:e,idWord:t,token:n,body:o}),l()}(n.id,t,n.token),h.disabled=!0,h.parentNode.childNodes[1].disabled=!1}}if(h.closest(".cont-button__remove")){const e=h.parentNode.parentNode;if(e.classList.contains("hard")){e.classList.remove("hard");const t=new a,n=e.dataset.id;c(t.id,n,t.token),l();const o=h.parentNode.childNodes[1],s=h.parentNode.childNodes[0];o.disabled=!0,s.disabled=!1}}if(h.closest(".cont-button__remove-to-dictionary")){const e=h.parentNode,t=new a,n=e.dataset.id;!async function(e,t,n){await c(e,t,n),document.querySelector(`div[data-id="${t}"]`).remove()}(t.id,n,t.token)}if(h.closest(".cont-button__studied")){const e=h.parentNode.parentNode,t=e.dataset.id;if(!e.classList.contains("studied")){e.classList.add("studied");const n=new a;!async function(e,t,n){const o={difficulty:"studied",optional:{}};await s(e,t,n)?await r({id:e,idWord:t,token:n,body:o}):await i({id:e,idWord:t,token:n,body:o}),l()}(n.id,t,n.token)}const n=h.parentNode.childNodes[1],o=h.parentNode.childNodes[0];n.disabled=!0,o.disabled=!0,h.disabled=!0}}))}document.addEventListener("DOMContentLoaded",(async function(){const e=new a;e.id&&n({id:e.id,token:e.token,name:e.name,refreshToken:e.refreshToken}),m()}))})();